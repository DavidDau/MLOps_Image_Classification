{% extends "base.html" %} {% block title %}Predict - Image Classification{%
endblock %} {% block content %}
<div class="row">
  <div class="col-md-8 offset-md-2">
    <h1 class="mb-4"><i class="fas fa-image"></i> Image Prediction</h1>

    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Upload an Image for Classification</h5>
        <form method="POST" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="file" class="form-label">Select Image File</label>
            <input
              type="file"
              class="form-control"
              id="file"
              name="file"
              accept="image/*"
              required
            />
            <div class="form-text">
              Supported formats: PNG, JPG, JPEG, GIF, BMP (Max 16MB)
            </div>
          </div>

          <div class="mb-3">
            <img
              id="preview"
              src=""
              alt="Preview"
              class="img-thumbnail"
              style="max-width: 400px; display: none"
            />
          </div>

          <button type="submit" class="btn btn-primary">
            <i class="fas fa-brain"></i> Predict
          </button>
        </form>
      </div>
    </div>

    {% if result %}
    <div class="card mt-4">
      <div
        class="card-header bg-{{ 'success' if result.success else 'danger' }} text-white"
      >
        <h5 class="mb-0">Prediction Results</h5>
      </div>
      <div class="card-body">
        {% if result.success %}
        <div class="row">
          <div class="col-md-6">
            {% if image_url %}
            <img
              src="{{ image_url }}"
              class="img-fluid rounded"
              alt="Uploaded Image"
            />
            {% endif %}
          </div>
          <div class="col-md-6">
            <h4>
              Predicted Class:
              <span class="badge bg-primary">{{ result.predicted_class }}</span>
            </h4>
            <h5>
              Confidence:
              <span class="badge bg-success"
                >{{ "%.2f"|format(result.confidence * 100) }}%</span
              >
            </h5>

            <div class="mt-4">
              <h6>All Class Probabilities:</h6>
              <div class="list-group">
                {% for class_name, prob in result.probabilities.items() %}
                <div class="list-group-item">
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <span>{{ class_name }}</span>
                    <span
                      class="badge bg-{{ 'primary' if class_name == result.predicted_class else 'secondary' }}"
                    >
                      {{ "%.2f"|format(prob * 100) }}%
                    </span>
                  </div>
                  <div class="progress mt-2" style="height: 20px">
                    <div
                      class="progress-bar bg-{{ 'primary' if class_name == result.predicted_class else 'secondary' }}"
                      style="width: {{ prob * 100 }}%"
                    ></div>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>

            <div class="mt-3">
              <p class="text-muted">
                <small>Timestamp: {{ result.timestamp }}</small>
              </p>
            </div>
          </div>
        </div>
        {% else %}
        <div class="alert alert-danger">
          <strong>Error:</strong> {{ result.error }}
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>
</div>

<script>
  // Image preview
  document.getElementById("file").addEventListener("change", function (e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const preview = document.getElementById("preview");
        preview.src = e.target.result;
        preview.style.display = "block";
      };
      reader.readAsDataURL(file);
    }
  });
</script>
{% endblock %}
