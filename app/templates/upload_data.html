{% extends "base.html" %} {% block title %}Upload Data - Image Classification{%
endblock %} {% block content %}
<div class="row">
  <div class="col-md-8 offset-md-2">
    <h1 class="mb-4"><i class="fas fa-upload"></i> Upload Training Data</h1>

    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Bulk Image Upload</h5>
      </div>
      <div class="card-body">
        <p>
          Upload multiple images to expand the training dataset. These images
          will be used in the next retraining cycle.
        </p>

        <form method="POST" enctype="multipart/form-data">
          <div class="mb-3">
            <label for="class_label" class="form-label">Select Class</label>
            <select
              class="form-select"
              id="class_label"
              name="class_label"
              required
            >
              {% if classes %} {% for class_name in classes %}
              <option value="{{ class_name }}">{{ class_name }}</option>
              {% endfor %} {% else %}
              <option value="class1">Class 1</option>
              <option value="class2">Class 2</option>
              {% endif %}
            </select>
            <div class="form-text">
              Select the class/category for the images you're uploading. {% if
              not classes %}
              <br /><strong>Note:</strong> Default classes shown. Classes will
              be created from your training data. {% endif %}
            </div>
          </div>

          <div class="mb-3">
            <label for="files" class="form-label">Select Images</label>
            <input
              type="file"
              class="form-control"
              id="files"
              name="files"
              accept="image/*"
              multiple
              required
            />
            <div class="form-text">
              You can select multiple images at once. Supported formats: PNG,
              JPG, JPEG, GIF, BMP
            </div>
          </div>

          <div class="mb-3">
            <div id="fileCount" class="alert alert-info" style="display: none">
              <strong>Files selected:</strong> <span id="count">0</span>
            </div>
          </div>

          <div class="mb-3">
            <div id="preview" class="row"></div>
          </div>

          <button type="submit" class="btn btn-primary">
            <i class="fas fa-cloud-upload-alt"></i> Upload Images
          </button>
        </form>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-header">
        <h5 class="mb-0">Instructions</h5>
      </div>
      <div class="card-body">
        <ol>
          <li>
            <strong>Select the class/category</strong> that the images belong to
          </li>
          <li>
            <strong>Choose multiple images</strong> from your computer (you can
            select many at once)
          </li>
          <li>
            <strong>Click Upload</strong> to add them to the training dataset
          </li>
          <li>
            After uploading, go to the
            <a href="{{ url_for('retrain') }}">Retrain</a> page to update the
            model
          </li>
        </ol>

        <div class="alert alert-warning mt-3">
          <i class="fas fa-exclamation-triangle"></i>
          <strong>Important:</strong>
          <ul class="mb-0">
            <li>Make sure images are clear and properly labeled</li>
            <li>Upload at least 20-50 images per class for best results</li>
            <li>Images will be automatically preprocessed during retraining</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // File count and preview
  document.getElementById("files").addEventListener("change", function (e) {
    const files = e.target.files;
    const count = files.length;

    // Show file count
    document.getElementById("count").textContent = count;
    document.getElementById("fileCount").style.display = "block";

    // Show previews (limit to 6)
    const preview = document.getElementById("preview");
    preview.innerHTML = "";

    const maxPreviews = Math.min(count, 6);
    for (let i = 0; i < maxPreviews; i++) {
      const file = files[i];
      const reader = new FileReader();

      reader.onload = function (e) {
        const col = document.createElement("div");
        col.className = "col-md-2 mb-2";

        const img = document.createElement("img");
        img.src = e.target.result;
        img.className = "img-thumbnail";
        img.style.width = "100%";

        col.appendChild(img);
        preview.appendChild(col);
      };

      reader.readAsDataURL(file);
    }

    if (count > 6) {
      const col = document.createElement("div");
      col.className = "col-md-2 mb-2";
      col.innerHTML =
        '<div class="alert alert-secondary text-center">+' +
        (count - 6) +
        " more</div>";
      preview.appendChild(col);
    }
  });
</script>
{% endblock %}
